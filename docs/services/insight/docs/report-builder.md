# Report Builder

The application uses a `report type` to fetch the data from the `provider` and then renders it using the configured `widget`. The widget takes its parameters from the `filters` and `columns` defined in the report type.

The API also supports downloading the data in excel, CSV, and pdf format. If a user has not defined any custom `report template` for the report type, the application will use the default template to build the pdf.

You can also `jobs` to schedule the system to send the report by email. The cron will look into the existing jobs and would trigger the report generation mechanism (using the defined filters). It would then email the report to the pre-configured list of users.

A report that is generated by the user will be available in the download section of the report view screens. Additionally, the widgets will show the download link of the last generated report

The application can get a set of widgets grouped by `report area` from the backend. For example, the `dashboard` can be a report group that has a collection of graphs and tables. You can build multiple dashboards each having its area code like `custom-dashboard`,  

Here are few key entities

## Data Source

It defines the **source** of the data. The application picks the `handler` and then `configures` it. It then uses the query from the provider to fetch the data

- Name: friendly text of the data; e.g. US Population
- Code: unique code of the source
- Handler: MYSQL, MongoDB, HTTP
- Config: is a JSON object with connection-related information. For example, 
  - for MYSQL it would have a username, password, database, host, port, etc.
  - for HTTP it would have root, headers, HTTP action (GET, POST), etc.

## Provider

It has all the `config` and `queries` to fetch the data. It also serves as a library of `filters` and `columns` which are used by **report builder** to define a report

- Name: friendly text of the provider; e.g. AgeWise Population (US)
- Code: unique code of the provider
- Data Source: from where to fetch the data
- Params: it is a set of params that goes into the where clause. It's fields are
  - key: the field to be pulled from the input object
  - type: the type of value (default string) to be inserted in the where clause
  - format: the formatter used when converting to string
  - condition: the DB comparator, can be one of the following `=`, `>`, `<`, `in` etc
  - value: the default value (if not specified in the report)
- Columns: a set of mappings between the DB and application. Here are the fields of the collection
  - key: the field name in the returned object. It is a flattened model; e.g. for a key like `address-city` an `address` object would be created with the field `city`
  - dataKey: the field returned by the DB
  - type: defines how the value is parsed
- Config: defines the queries and other configs that the provider uses to fetch the data. It may look like this (assuming MYSQL provider)
  - select:
  - from:
  - where:
  - group:
  - sort:
  - summary:

## Defining a Report

Fields:

- Name: Title of the report; e.g. Population Age Table
- Code: unique code of the report
- Description: the information about the report
- Icon: give an icon to your report(can be URL of the icon image)
- Widget: is the widget code that renders the report
- Area: Where would this report show up; e.g. Area
- Provider: The base mechanism to fetch the report
- Columns: a set of re-mappings of the data object to the widget model. Here are the fields of the collection
  - key: the key for the widget.
  - label: the label to show on the widget
  - description: kind of helpful text about the column
  - formula: this can be the key of the object returned from the provider or can be a formula combining multiple fields of the object
  - format: used to convert data to a string
  - icon: icon to represent the column
  - style: a JSON object that would be used by widget to style the value
- Filters: It is a collection of filters that the widget would render. Its fields are
  - key: the key to building the where an object (must match it to the provider's params)
  - label: the label to show on the widget
  - control: the control(code) that the widget renders to fetch the value
  - field: the field of the control value that needs to be picked
  - displayField: the field of the control that that is used to render in filter summary
- Permissions: as a set of permission that the user must have to view this report
- Config: it is a set of configs used by the widget to render itself.
  - summary: if set (to one of the stats, pie-chart, total-row) it is rendered
  - download: one of following
    - excel: `{ sheet: 'data', header: { what goes into the header } }`, 
    - csv: `{}`, 
    - pdf: `{ template: {code: ''}, layout: 'portrait', size: ''}`
  - click: `{ url: '{{app-root-url}}/details/:key', open: 'popup|new-tab|current' }`; the items in the url will be injected
