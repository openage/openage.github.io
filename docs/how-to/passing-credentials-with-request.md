# Passing credentials with a request

Framework supports different type of secrets for authentication. While password and OTP credentials are contextual in nature, there are other credentials that uniquely identifies the authenticated user. 

The system identifies a user based on the following logic
1. Online - The service goes to the auth service (the directory) and gets the details of the user (including its organization and tenant)
2. Offlie - The service decrypts the token and extracts the credentials from it.

If only `tenant-code` is passed - the user is treated as a guest of the application.
If both `tenant-code` && `organization-code` are passed - the user is treated as a guest of an organization within application.

These user creedntisl are of 2 types:

1. Token: It is auto expiring encrypted JWT token that is associated with the current user session. They have the purpose and expiry period buit into them. A token has following attributes

```JSON
{
    //TODO: complete this object
    "sessionId": "xxxxxxxxxxxxxxxxxxxxxxxx",
    "userId": "xxxxxxxxxxxxxxxxxxxxxxxxx",
    "roleId": "xxxxxxxxxxxxxxxxxxxxxxxxx",
    "email":"user@tenant.com",
    "purpose":"login",
    "permissions":[]
}
```

2. Role Key: The key is associates with the user's role, and expires only when there are changes to the role.

## Getting the credentials
### Token
You can get the token when a session a session is created. The session can be generated by login or via The system would inject the token into th

![[fix-me.jpg]]
TODO: insert image - web-app>landing>login

### Getting the role key

![[fix-me.jpg]]
TODO: insert image - web-app>settings>profile>Get Key

### Getting the organization code

![[fix-me.jpg]]
TODO: insert image - web-app>settings>organization>Get Code


### Getting the tenant code

![[fix-me.jpg]]
TODO: insert image - web-app>settings>tenants>Get Code

---

## Using the credentials

### Using in header

Once you obtain the role-key from login you can pass it in one of the following ways

```JSON
{
    "x-access-token": "xxxxxxxxxxxxxxxxxxxxxxxxx"
}
```

```JSON
{
    "x-role-key": "xxxxxxxxxxxxxxxxxxxxxxxxx"
}
```

### Passing in url
Credentials can also be passed in the query string of every request

HTTP GET `{{api-root-url}}/resource?access-token=xxxxxxxxxxxxxxxxxxxxxxxxx`
HTTP GET `{{api-root-url}}/resource?role-key=xxxxxxxxxxxxxxxxxxxxxxxxx`



## Request without credentials
There are 2 cases where user can access a resource without credentials

### Public Resources
Guest users can access public API resources without 
For a guest user, the tenant code must be passed. It can also be passed in header or query


```json
{
    "x-tenant-code": "my-application"
}
```

- in the query of every request

HTTP ACTION `{{api-root-url}}/resources?tenant-code=my-application`

### Hidden credentials
You can create an `aka` url. These urls save the session token in db and collects the data from the API and renders them as a standalone page

Checkout [how to create](aka-url.md) an aka url for more details.


